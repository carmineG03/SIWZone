<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Aggiungi Prodotto - SIWZone</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
	<link href="/css/headerFooter.css" rel="stylesheet" type="text/css">
	<link href="/css/stileIndex.css" rel="stylesheet" type="text/css">
	<link href="/css/stileInserimento.css" rel="stylesheet" type="text/css">
</head>

<body>
	<!-- Navbar -->
	<div class="navbar" id="navbar">
		<div class="nav-links">
			<a href="/">Home</a>
			<a href="/showAllProdotti">Prodotti</a>
			<a href="/admin/success">Area Riservata</a>
		</div>

		<div class="search-bar">
			<form th:action="@{/ricercaHome}" method="POST">
				<input type="text" 
				       name="keyword" 
				       th:value="${keyword}" 
				       placeholder="Cerca..." 
				       list="prodotti-datalist"
				       autocomplete="off">
				<datalist id="prodotti-datalist">
					<option th:each="nome : ${nomiProdotti}" th:value="${nome}"></option>
				</datalist>
				<button type="submit">Cerca</button>
			</form>
		</div>

		<div th:if="${userDetails}" class="auth-links">
			<span th:text="${userDetails.username}"></span>
			<a href="/logout">Logout</a>
		</div>
		<div th:unless="${userDetails}" class="auth-links">
			<a href="/login">Login</a>
			<a href="/register">Registrazione</a>
		</div>
		<span class="menu-icon" onclick="toggleMenu()">&#9776;</span>
	</div>

	<div class="container">
		<h1><i class="fas fa-plus"></i> Inserisci Prodotto</h1>

		<!-- FORM DI VALIDAZIONE DEL PRODOTTO-->
		<form th:action="@{/admin/creaProdotto}" method="POST" th:object="${prodottoDTO}" enctype="multipart/form-data">
			<div>
				<label for="nome">Nome Prodotto:</label>
				<input type="text" id="nome" name="nome" th:field="*{nome}" />
				<div th:if="${#fields.hasErrors('nome')}" th:errors="*{nome}">Errore Nome</div>
			</div>
			<div>
				<label for="prezzo">Prezzo:</label>
				<input type="number" step="0.01" id="prezzo" name="prezzo" th:field="*{prezzo}" />
				<div th:if="${#fields.hasErrors('prezzo')}" th:errors="*{prezzo}">Errore
					Prezzo</div>
			</div>

			<!-- SEZIONE PER LA LISTA DELLE CATEGORIE DI PRODOTTO -->
			<div>
				<label for="tipologia">Tipologia:</label>
				<select id="tipologia" name="tipologia" th:field="*{tipologia}">
					<option value="Top">Top</option>
					<option value="Giardinaggio">Giardinaggio</option>
					<option value="Prodotti">Prodotti</option>
					<option value="Informatica">Informatica</option>
					<option value="Elettronica">Elettronica</option>
					<option value="Auto e Moto">Auto e Moto</option>
					<option value="Articoli Sportivi">Articoli Sportivi</option>					
				</select>
			</div>

			<!-- SEZIONE PER LA DESCRIZIONE-->
			<div>
				<label for="descrizione">Descrizione:</label>
				<textarea id="descrizione" name="descrizione" rows="4" placeholder="Inserisci la descrizione del prodotto....." 
					maxlength="500" oninput="updateCharCounter()" th:field="*{descrizione}"></textarea>
				<div class="error" th:if="${#fields.hasErrors('descrizione')}" th:errors="*{descrizione}">Errore</div>
				<div id="charCounter" class="char-counter">0 / 500 caratteri</div>
			</div>

			<!-- INSERIMENTO IMMAGINI -->
			<div>
				<label for="immagine">Immagine</label>
				<input type="file" th:field="*{files}" name="immagine" multiple="multiple" accept="image/*"
					onchange="previewImage()" required id="immagine" />
				<div th:if="${#fields.hasErrors('files')}" th:errors="*{files}">Errore Immagine</div>

				<img id="imagePreview" class="image-preview" alt="Anteprima Immagine">
			</div>
			<div style="display: flex; justify-content: space-between; gap: 10px;">
				<button type="button" onclick="window.location.href='/admin/prodotti'" style="background-color: #6c757d;">
					<i class="fas fa-arrow-left"></i> Torna ai Prodotti
				</button>
				<button type="submit">
					<i class="fas fa-plus"></i> Inserisci Prodotto
				</button>
			</div>
		</form>
	</div>

	<script>
		function toggleMenu() {
			var navbar = document.getElementById('navbar');
			navbar.classList.toggle('responsive');
		}

		function updateCharCounter() {
			const textarea = document.getElementById('descrizione');
			const counter = document.getElementById('charCounter');
			counter.textContent = `${textarea.value.length} / 500 caratteri`;
		}

		function previewImage() {
			const fileInput = document.getElementById('immagine');
			const preview = document.getElementById('imagePreview');
			const file = fileInput.files[0];
			const reader = new FileReader();

			reader.onloadend = function () {
				preview.src = reader.result;
				preview.style.display = 'block';
			}

			if (file) {
				reader.readAsDataURL(file);
			} else {
				preview.src = '';
				preview.style.display = 'none';
			}
		}
	</script>

	<!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>SIWZone</h3>
                <p>Aggiungi prodotti nel catalogo - Area Amministratori.</p>
            </div>
            <div class="footer-section">
                <h3>Link Utili</h3>
                <ul>
                    <li><a href="/">Home</a></li>
                    <li><a href="/admin/prodotti">Gestisci Prodotti</a></li>
                    <li><a href="/admin/success">Area Riservata</a></li>
                    <li><a href="/logout">Logout</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 SIWZone. Tutti i diritti riservati.</p>
        </div>
    </footer>
</body>
</html>